{% extends 'base.html' %}
{% block content %}
<h1>Departments</h1>
<a href="{{ url_for('department.list_departments', view='table') }}">Switch to Table View</a>
<a href="{{ url_for('department.create_department') }}" class="btn btn-primary">Create New Department</a>

<ul id="department-tree">
  {% macro render_tree(departments, parent_id=None) %}
    {% for dept in departments if dept.parent_id == parent_id %}
      <li>
        <span class="toggle">[+]</span>
        <strong>{{ dept.name }}</strong>
        <a href="{{ url_for('department.edit_department', id=dept.id) }}" style="margin-left: 10px;">Edit</a>
        <form action="{{ url_for('department.delete_department', id=dept.id) }}" method="post" style="display:inline; margin-left: 10px;">
          <button type="submit">Delete</button>
        </form>
        <ul class="children" style="display:none;">
          {{ render_tree(departments, dept.id) }}
        </ul>
      </li>
    {% endfor %}
  {% endmacro %}

  {{ render_tree(departments) }}
</ul>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.toggle').forEach(function(toggle) {
      toggle.addEventListener('click', function () {
        const children = this.parentElement.querySelector('.children');
        if (children.style.display === 'none') {
          children.style.display = 'block';
          this.textContent = '[-]';
        } else {
          children.style.display = 'none';
          this.textContent = '[+]';
        }
      });
    });
  });
</script>
{% endblock %}