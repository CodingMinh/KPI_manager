{% extends 'base.html' %}

{% block content %}
<h2>Access Requests</h2>
<table class="table">
  <thead>
    <tr>
      <th>User</th>
      <th>Reason</th>
      <th>Status</th>
      <th>Requested At</th>
      <th>Decision</th>
    </tr>
  </thead>
  <tbody>
    {% for r in requests %}
    <tr>
      <td>{{ r.user.name }}</td>
      <td>{{ r.reason }}</td>
      <td>{{ r.status }}</td>
      <td>{{ r.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
      <td>
        {% if r.status == 'pending' %}
        <form action="{{ url_for('auth.handle_access_request', request_id=r.id, action='approve') }}" method="post" style="display:inline">
          <select name="role_id" class="form-select form-select-sm d-inline w-auto">
            {% for role in roles %}
              <option value="{{ role.id }}">{{ role.name }}</option>
            {% endfor %}
          </select>
          <select name="department_id" class="form-select form-select-sm d-inline w-auto">
              {% for dept in departments %}
                <option value="{{ dept.id }}">{{ dept.name }}</option>
              {% endfor %}
          </select>
          <button class="btn btn-success btn-sm">Approve</button>
        </form>
        <form action="{{ url_for('auth.handle_access_request', request_id=r.id, action='deny') }}" method="post" style="display:inline">
          <button class="btn btn-danger btn-sm">Deny</button>
        </form>
        {% else %}
          {{ r.status.title() }}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}